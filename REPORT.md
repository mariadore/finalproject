# Project Report – London Crime, Weather, and Transit Analysis

> **Update the bracketed uniqnames/emails before submitting.** Add screenshots of the PNG files listed below to the document you upload to Canvas.

## 1. Project Goals (Planned)
- Gather UK Police crime data, TomTom reverse geocoding data, Open-Meteo daily weather, and TfL StopPoint transit data for central London.
- Store at least 100 rows per source in a single SQLite database with normalized location + street tables.
- Calculate how weather types, temperature, wind speed, rainfall, and transit proximity affect crime counts.
- Produce visualizations that go beyond lecture examples (multi-axis bar/line combos, scatter trends, cumulative curves) and document the workflow for grading.

## 2. Achieved Goals
- Successfully ingested all four APIs with ≤25 records per run until the database met the ≥100-row threshold for each source.
- Built deterministic joins across `CrimeData`, `LocationData`, `WeatherData`, and `TransitStops`, enabling rich pandas aggregations.
- Rendered five polished Matplotlib/Seaborn plots plus a textual analysis summary saved to `analysis_summary.txt`.
- Automated pipeline via `finalproject.py` so every deliverable (database, analysis, PNGs, report text) is reproducible.

## 3. Problems Faced
- **Rate limiting**: TfL occasionally throttled StopPoint requests; added cursor rotation + per-run caps to stay compliant.
- **Missing geocodes**: Some crimes lacked precise coordinates; default London locations plus incremental TomTom re-tries resolved the gap.
- **Weather sparsity**: Open-Meteo sometimes omits humidity; calculations now guard against `NULL` values by averaging min/max temperatures instead.

## 4. Database Calculations
- `src/analysis.py` joins all required tables (including at least one explicit join for every calculation).
- Representative outputs are saved in `analysis_summary.txt`. Paste an excerpt or screenshot of that file into your Canvas submission to satisfy the "calculated data" requirement.

## 5. Visualizations
Attach or reference the PNG files generated by running `python finalproject.py`:
1. `avg_crimes_weather.png`
2. `temp_vs_crime.png`
3. `wind_vs_crime.png`
4. `precip_vs_crime.png`
5. `transit_modes.png`
6. `transit_hotspots.png`

## 6. Instructions for Running the Code
1. (Optional) `python3 -m venv .venv && source .venv/bin/activate`
2. `pip install -r requirements.txt`
3. `python finalproject.py --month 2023-09`
4. Re-run the command as many times as necessary until the console reports that all API tables exceed 100 rows.
5. Use `--allow-seed` only when demonstrating offline; Canvas submissions should reflect real API data.
6. Collect additional months by passing another value to `--month` without editing source code.

## 7. Function Diagram & Ownership
| Function | File | Input | Output | Owner |
| --- | --- | --- | --- | --- |
| `fetch_and_store_crimes` | `src/fetch_crime.py` | Month string, polygon, max items | ≤25 normalized crime rows inserted into `CrimeData` | Lucia [Last Name] (`[uniq]@umich.edu`)
| `geocode_and_attach_locations` | `src/fetch_geocode.py` | Open DB connection, max items | ≤25 TomTom lookups stored in `LocationData` + linked crimes | Maria [Last Name] (`[uniq]@umich.edu`)
| `fetch_weather_for_all_locations` | `src/fetch_weather.py` | Open DB connection, list of dates, per-run cap | ≤25 weather rows inserted into `WeatherData` | Brielle [Last Name] (`[uniq]@umich.edu`)
| `fetch_transit_stops` | `src/fetch_transit.py` | Lat/lon, stop types, modes, cap | ≤25 TfL stops saved into `TransitStops` | Brielle [Last Name] (`[uniq]@umich.edu`)
| `calculate_crimes_by_weather` | `src/analysis.py` | DB connection | DataFrame w/ avg crimes per weather type | Lucia [Last Name]
| `calculate_crimes_near_transit` | `src/analysis.py` | DB connection | DataFrame summarizing crimes by mode | Maria [Last Name]
| `visualize_results` | `src/visualize.py` | All DataFrames | PNG visualizations listed above | Team
| `write_analysis_report` | `src/report.py` | Analysis DataFrames | `analysis_summary.txt` text report | Team

## 8. Resource Log
| Date | Issue | Description / Resource | Result |
| --- | --- | --- | --- |
| 2023-11-04 | Understand UK Police polygon format | https://data.police.uk/docs/method/crimes-street/ | Confirmed polygon string order + monthly parameter requirements. |
| 2023-11-08 | Map Open-Meteo weather codes to readable labels | https://open-meteo.com/en/docs/historical-weather-api | Added `WEATHER_CODE_MAP` and `weather_main` column. |
| 2023-11-10 | Handle TfL StopPoint pagination + throttling | https://api.tfl.gov.uk/ | Implemented rotating cursor stored in `api_cursors` to spread requests across transit modes. |

Fill in any additional resources you used along the way so the log reflects your actual work.
